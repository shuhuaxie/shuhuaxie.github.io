---
layout: post
title:  "2019-12-02-局域网联网原理.markdown"
date:   2019-12-02 12:11:30 +0800

1. 局域网一般情况下只有一个ip地址,如何实现对外网的访问

1) 局域网对外网的访问通过SNAT原理进行(Source Network Address Translation)
本地局域网的ip地址是内网ip地址,由本地生成的网络请求,在经过路由器转发时,会将源地址转化为局域网的独立ip地址
并向外网转发.
在经过广域网的传播,目标服务器响应请求,并将数据最终传递给局域网路由器.
局域网路由器会改变响应的目标ip地址,将数据转发给内网ip对应主机.
2) 局域网响应外网的访问可以通过DNAT(Destination Network Address Translation)
即在响应请求和返回数据时,改变对应的目标网址和起始网址
2. 局域网ip段限制

3. ip寻址详细过程
1) 通过二层交换机直连的两台主机之间的数据传输
A会发一个ARP广播
交换机收到ARP广播后，将它转发到所有端口（网口）
B收到广播 发现和自己IP匹配 就会向A发送ARP响应
交换机收到B的响应 将响应帧目标MAC与自己mac地址表对比

（-----交换机的工作原理：它维护了一张 MAC 地址表，用来反映各端口和 MAC 地址的对应关系，以便做好数据转发工作

-----路由器的工作原理：在路由器中也要维护一张表格，叫做路由条目表，用来反映如何到达某个 IP 地址网段，
同时在路由器中也有 ARP 高速缓存，反映了该路由器各直接网段的 IP 地址和 MAC 地址的对应关系 ）

2) 跨三层交换机
由于 B 的 IP 地址并没有和 A 在一个网段，所以当 A 向 B 发送数据时， A 并不会直接把数据给 B ，而是交给自己的网关，所以 A 首先会 ARP 广播请求 网关 的 MAC 地址 A 得到网关的 MAC 地址后，以它为数据帧的目标 MAC 地址进行封装数据，并发送出去
Router1 收到该帧后，检查该帧的目标 IP ，并到自己的路由表查找如何到达该网段 发现能够到，并且下一跳地址是 routerB 的 s0 端口，于是将数据重新封装，将源地址改为 s0 端口 MAC 地址，目标 MAC 地址改为 router2 的 s0 端口 MAC 址址，并发送给 router2
...
最后一个路由（routerN ）收到该帧，发现目标 IP 就在自己的直连网段，于是查看 ARP 缓存，如果找到该 IP 的 MAC 地址，则以该 MAC 地址封装数据发送出去，如果在 ARP 缓存没找到，则发出 ARP 广播，请求该 IP 的 MAC 地址，得到对应的 MAC 地址后，再发送给主机 B

4. 局域网内网ip范围
1)举例
手机
设置->我的设备->全部参数->状态信息->
wifi: ip fe80-e262-67ff-fe54-d9d4/192.168.20.125
有线: 10.230.153.151
电脑
局域网无线:192.168.20.36 子网掩码:255.255.255.0

IPv4关于内网IP的规定及其划分和使用的原则

IPv4协议规定了三个地址段作为内网地址，不用做公网互联的使用：

    A类内网地址段是10.*.*.*
    B类内网地址段是从172.16.*.*～172.31.*.*
    C类内网地址段是192.168.*.*

惯例上A类内网地址在运营商一级网络使用；
B类内网IP在城域网范围内使用；
C类内网IP就是用作家庭公司等小型局域网络。

网址:
 https://www.linuxidc.com/Linux/2013-08/88536p2.html
 http://baijiahao.baidu.com/s?id=1643188271992593887&wfr=spider&for=pc

 
    